{% extends 'shopping_cart/base.html' %}
{% block content %}
<h1>Hi {{ request.user.username }}!</h1>
<h1>Your Cart:</h1>
<table id="cart_table">
	<tr>
		<th>Items In Cart </th><a href="{% url 'previous_orders' %}">View Past Orders</a>
	</tr>
	<tr>
		<th>Item</th><th>Price</th><th>Quantity</th>
	</tr>
	{% for i in cart_items %}
	<tr>
		<td align="left">{{ i.name }}</td><td>${{ i.price|floatformat:2 }}</td><td> {{ i.quantity }}</td>
	</tr>
	{% endfor %}
</table>
<div id='recommendations'>
  {% if recommendations.any %}
  <h1>Recommended for you:</h1>
  {% endif %}
  {% for i in recommendations %}
  <h3>{{ i.name }}</h3>
  <table class="item_table">
  <tr>
    <th>Description</th><th>Price</th><th>In Stock?</th>
  </tr>
  <tr>
  	<td align="left">{{ i.description }}</td><td>${{ i.price|floatformat:2 }}</td><td> {{ i.in_stock|yesno:"Yes, Out Of stock" }}</td>
  	<td>
  		<form method='POST' action='{% url "inline_add_to_cart" %}'>
  			{% csrf_token %}
  			<input type="hidden" value='{{ i.id }}' name='item_id'>
  			<input type="hidden" value='{{ i.name }}' name='item_name'>
  			<input type="hidden" value='{{ i.price }}' name='item_price'>
  			<input type="number" name="quantity" min="1" max="{{ i.quantity }}">
  			<input type='submit' value='Buy Now!' class='buy_button'>
  		</form>
  	</td>
  </tr>
  </table>
  {% endfor %}
  <a href="{% url 'checkout' %}">Checkout?</a>
<script type="text/javascript">
// from mbstock
var w = 960,
    h = 500,
    p = [20, 50, 30, 20],
    x = d3.scale.ordinal().rangeRoundBands([0, w - p[1] - p[3]]),
    y = d3.scale.linear().range([0, h - p[0] - p[2]]),
    z = d3.scale.ordinal().range(["lightpink", "darkgray", "lightblue"]),
    parse = d3.time.format("%m/%Y").parse,
    format = d3.time.format("%b");

var svg = d3.select("svg")

var data = [
  {'item_id': u'4', 'price': u'10.5', 'name': u'Eye Patch', 'quantity': u'1'}, 
  {'item_id': u'1', 'price': u'10000', 'name': u'Time', 'quantity': u'1'}, 
  {'item_id': u'7', 'price': u'800', 'name': u'Fender Strat', 'quantity': u'1'}, 
  {'item_id': u'7', 'price': u'800', 'name': u'Fender Strat', 'quantity': u'1'}
];


//d3.csv("crimea.csv", function(crimea) {

  // Transpose the data into layers by cause.
  //var causes = d3.layout.stack()(["wounds", "other", "disease"].map(function(cause) {
    //return crimea.map(function(d) {
      //return {x: parse(d.date), y: +d[cause]};
   // });
  //}));

  // Compute the x-domain (by date) and y-domain (by top).
  x.domain(causes[0].map(function(d) { return d.x; }));
  y.domain([0, d3.max(causes[causes.length - 1], function(d) { return d.y0 + d.y; })]);

  // Add a group for each cause.
  var cause = svg.selectAll("g.cause")
      .data(causes)
    .enter().append("svg:g")
      .attr("class", "cause")
      .style("fill", function(d, i) { return z(i); })
      .style("stroke", function(d, i) { return d3.rgb(z(i)).darker(); });

  // Add a rect for each date.
  var rect = cause.selectAll("rect")
      .data(Object)
    .enter().append("svg:rect")
      .attr("x", function(d) { return x(d.x); })
      .attr("y", function(d) { return -y(d.y0) - y(d.y); })
      .attr("height", function(d) { return y(d.y); })
      .attr("width", x.rangeBand());

  // Add a label per date.
  var label = svg.selectAll("text")
      .data(x.domain())
    .enter().append("svg:text")
      .attr("x", function(d) { return x(d) + x.rangeBand() / 2; })
      .attr("y", 6)
      .attr("text-anchor", "middle")
      .attr("dy", ".71em")
      .text(format);

  // Add y-axis rules.
  var rule = svg.selectAll("g.rule")
      .data(y.ticks(5))
    .enter().append("svg:g")
      .attr("class", "rule")
      .attr("transform", function(d) { return "translate(0," + -y(d) + ")"; });

  rule.append("svg:line")
      .attr("x2", w - p[1] - p[3])
      .style("stroke", function(d) { return d ? "#fff" : "#000"; })
      .style("stroke-opacity", function(d) { return d ? .7 : null; });

  rule.append("svg:text")
      .attr("x", w - p[1] - p[3] + 6)
      .attr("dy", ".35em")
      .text(d3.format(",d"));
});

</script>
</div>
{% endblock %}